(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{367:function(s,a,t){"use strict";t.r(a);var e=t(7),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ssl-证书申请"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssl-证书申请"}},[s._v("#")]),s._v(" SSL 证书申请")]),s._v(" "),a("h2",{attrs:{id:"方式1-acme-sh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式1-acme-sh"}},[s._v("#")]),s._v(" 方式1："),a("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh",target:"_blank",rel:"noopener noreferrer"}},[s._v("acme.sh"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("该方式基于 Ubuntu 20.04、Nginx 1.22 测试通过，更多用法可前往"),a("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh",target:"_blank",rel:"noopener noreferrer"}},[s._v("Github"),a("OutboundLink")],1),s._v("查看")]),s._v(" "),a("h3",{attrs:{id:"_1-安装acme-sh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装acme-sh"}},[s._v("#")]),s._v(" 1.安装acme.sh")]),s._v(" "),a("p",[s._v("先安装socat")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" socat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n")])])]),a("p",[s._v("邮箱替换成自己的")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" https://get.acme.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("email")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("chen1406736605@gmail.com\n")])])]),a("h3",{attrs:{id:"_2-source"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-source"}},[s._v("#")]),s._v(" 2.source")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" ~/.bashrc\n")])])]),a("h3",{attrs:{id:"_3-生成证书-这里采用dns方式-http方式请前往github查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-生成证书-这里采用dns方式-http方式请前往github查看"}},[s._v("#")]),s._v(" 3.生成证书（这里采用DNS方式，HTTP方式请前往"),a("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh",target:"_blank",rel:"noopener noreferrer"}},[s._v("Github"),a("OutboundLink")],1),s._v("查看）")]),s._v(" "),a("p",[s._v("设置dns运营商的识别 ID 和 Secret (已设置的无需重复设置)，acme也支持多家"),a("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh/wiki/dnsapi",target:"_blank",rel:"noopener noreferrer"}},[s._v("dsn运营商"),a("OutboundLink")],1),s._v("，我这里采用的是阿里云")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Ali_Key")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sdfsdfsdfljlbjkljlkjsdfoiwje"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Ali_Secret")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jlsdflanljkljlfdsaklkjflsa"')]),s._v("\n")])])]),a("p",[s._v("切换CA机构（默认ZeroSSL，ZeroSSL老是容易超时，中意ZeroSSL可以忽略）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("acme.sh --set-default-ca "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--server")]),s._v(" letsencrypt\n")])])]),a("p",[s._v("申请证书")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("acme.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--issue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dns")]),s._v(" dns_ali "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" example.com\n")])])]),a("h3",{attrs:{id:"_4-安装证书-不要直接引用acme生成的路径-也不要使用复制的方式-手动复制会使自动更新失效"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-安装证书-不要直接引用acme生成的路径-也不要使用复制的方式-手动复制会使自动更新失效"}},[s._v("#")]),s._v(" 4.安装证书（不要直接引用acme生成的路径，也不要使用复制的方式，手动复制会使自动更新失效）")]),s._v(" "),a("p",[s._v("这里的路径就是实际就是你想存放证书的路径，对应文件夹要提前创建（例如我习惯放置的路径为/etc/nginx/ssl/域名）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("acme.sh --install-cert "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" example.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--key-file       /etc/nginx/ssl/example.com/key.pem  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--fullchain-file /etc/nginx/ssl/example.com/cert.pem\n")])])]),a("h3",{attrs:{id:"_5-配置-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置-nginx"}},[s._v("#")]),s._v(" 5.配置 Nginx")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#以下属性中，以ssl开头的属性表示与证书配置有关。")]),s._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置HTTPS的默认访问端口为443。")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果未在此处配置HTTPS的默认访问端口，可能会造成Nginx无法启动。")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果您使用Nginx 1.15.0及以上版本，请使用listen 443 ssl代替listen 443和ssl on。")]),s._v("\n    server_name example.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ssl_certificate /etc/nginx/ssl/example.com/cert.pem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ssl_certificate_key /etc/nginx/ssl/example.com/key.pem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    ssl_session_timeout 5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("NULL:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("aNULL:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("MD5:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("ADH:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("RC4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示使用的加密套件的类型。")]),s._v("\n    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示使用的TLS协议的类型，您需要自行评估是否配置TLSv1.1协议。")]),s._v("\n    ssl_prefer_server_ciphers on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        root html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Web网站程序存放目录。")]),s._v("\n        index index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    server_name example.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#需要将yourdomain替换成证书绑定的域名。")]),s._v("\n    rewrite ^"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将所有HTTP请求通过rewrite指令重定向到HTTPS。")]),s._v("\n    location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        index index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h3",{attrs:{id:"_6-完成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-完成"}},[s._v("#")]),s._v(" 6.完成")]),s._v(" "),a("p",[s._v("可以尝试检测或访问")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("https://myssl.com/ssl.html\n")])])]),a("p",[s._v("更新：acme.sh会自动更新证书")])])}),[],!1,null,null,null);a.default=n.exports}}]);